<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="/client/layout"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${productDetails.name}">N/A</title>
  </head>

  <body>
    <main class="product-details" layout:fragment="content">
      <div class="container">
        <!-- breadcrumb -->
        <ul class="breadcrumb">
          <li><a href="/">Trang chủ</a></li>
          <li><a href="/shop">Cửa hàng</a></li>
          <li th:text="${productDetails.name}"></li>
        </ul>

        <!-- product details header -->
        <div class="product-details-header">
          <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-6">
              <div class="product-images">
                <a
                  target="_blank"
                  th:href="${'/' + resourcesMappingFolder + '/' + productPicturesFolder + '/' + (productDetails.productImages != null and productDetails.productImages.size() > 0 ? productDetails.productImages[0].imageName : '')}"
                  class="main-image"
                >
                  <img
                    th:src="${'/' + resourcesMappingFolder + '/' + productPicturesFolder + '/' + (productDetails.productImages != null and productDetails.productImages.size() > 0 ? productDetails.productImages[0].imageName : '')}"
                    alt="product"
                /></a>
                <div
                  class="thumbnails thumbnails-carousel owl-carousel owl-theme"
                >
                  <div
                    class="thumbnail"
                    th:each="productImage, stat : ${productDetails.productImages}"
                    th:classappend="${stat.index == 0} ? ' active' : ''"
                  >
                    <img
                      th:src="${'/' + resourcesMappingFolder + '/' + productPicturesFolder + '/' + productImage.imageName}"
                      alt="product thumbnail"
                    />
                  </div>
                </div>
              </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-6">
              <div class="product-summary">
                <a
                  class="product-category"
                  th:href="${'/shop?categories=' + (productDetails.category != null ? productDetails.category.slug : 'other')}"
                  th:text="${productDetails.category != null ? productDetails.category.name : 'Khác' }"
                ></a>
                <h1 class="product-name" th:text="${productDetails.name}"></h1>
                <a
                  class="product-brand"
                  th:href="${'/shop?brands=' + (productDetails.brand != null ? productDetails.brand.slug : 'other')}"
                  th:text="${productDetails.brand != null ? productDetails.brand.name : 'Khác'}"
                ></a>
                <p
                  class="product-stock-status stock-status"
                  th:classappend="${productDetails.quantity > 0 ? 'in-stock' : 'out-stock'}"
                  th:text="${productDetails.quantity > 0 ? 'Còn hàng' : 'Hết hàng'}"
                ></p>
                <div class="product-pricing">
                  <p
                    class="price"
                    th:text="${#numbers.formatDecimal(productDetails.discountPrice, 0, 'COMMA', 0, 'POINT')} + '₫'"
                  ></p>
                  <div
                    class="discount-information"
                    th:if="${productDetails.discount > 0}"
                  >
                    <p
                      class="old-price"
                      th:text="${#numbers.formatDecimal(productDetails.price, 0, 'COMMA', 0, 'POINT')} + '₫'"
                    ></p>
                    <span
                      class="discount-value danger-badge"
                      th:text="'-' + ${productDetails.discount} + '%'"
                    ></span>
                  </div>
                </div>
                <p
                  class="product-short-description"
                  th:text="${productDetails.shortDescription}"
                ></p>
                <div class="product-quantity">
                  <button
                    id="btnQuantityMinus"
                    class="quantity-minus-button primary-button"
                    type="button"
                  >
                    <i class="fa-solid fa-minus"></i>
                  </button>
                  <input
                    class="quantity-input"
                    type="number"
                    name="quantity"
                    value="1"
                    min="1"
                    max="99"
                    disabled
                  />
                  <button
                    id="btnQuantityPlus"
                    class="quantity-plus-button primary-button"
                    type="button"
                  >
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>

                <div class="product-actions">
                  <form
                    th:if="${productDetails.quantity > 0}"
                    class="buy-now-form"
                    th:action="@{/cart/buy-now/{id}(id=${productDetails.id})}"
                    method="post"
                  >
                    <input
                      type="hidden"
                      name="quantity"
                      class="quantity-input"
                      value="1"
                      min="1"
                      max="99"
                    />
                    <button class="buy-now-button primary-button" type="submit">
                      <i class="fas fa-money-bill-wave"></i>Mua ngay
                    </button>
                  </form>
                  <form
                    class="add-cart-form"
                    th:action="@{/cart/add/{id}(id=${productDetails.id})}"
                    method="post"
                  >
                    <input
                      class="quantity-input"
                      type="hidden"
                      name="quantity"
                      value="1"
                      min="1"
                      max="99"
                    />
                    <button
                      class="add-cart-button secondary-button"
                      type="submit"
                    >
                      <i class="fa-solid fa-cart-shopping"></i>Thêm vào giỏ
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- product details body -->
        <div class="product-details-body">
          <h2 class="product-details-title">Mô tả</h2>
          <div class="product-information">
            <div class="product-about">
              <h3 class="about-title">Giới thiệu:</h3>
              <p
                class="about-description"
                th:text="${productDetails.description}"
              ></p>
            </div>
            <div class="product-specification">
              <h3 class="specification-title">Thông số kỹ thuật:</h3>
              <dl class="specification-description-list description-list row">
                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  CPU:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.cpu) ? 'N/A' : productDetails.cpu}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  GPU:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.gpu) ? 'N/A' : productDetails.gpu}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Ram:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.ram) ? 'N/A' : productDetails.ram}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Bộ nhớ:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.storage) ? 'N/A' : productDetails.storage}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Hệ thống tản nhiệt:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.cooling) ? 'N/A' : productDetails.cooling}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Cổng kết nối:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.io) ? 'N/A' : productDetails.io}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Màn hình:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.screen) ? 'N/A' : productDetails.screen}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Bàn phím:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.keyboard) ? 'N/A' : productDetails.keyboard}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Âm thanh:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.audio) ? 'N/A' : productDetails.audio}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Thẻ nhớ:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.sdCard) ? 'N/A' : productDetails.sdCard}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Mạng LAN:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.lan) ? 'N/A' : productDetails.lan}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Wifi:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.wifi) ? 'N/A' : productDetails.wifi}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Bluetooth:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.bluetooth) ? 'N/A' : productDetails.bluetooth}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Webcam:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.webCam) ? 'N/A' : productDetails.webCam}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Hệ điều hành:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.os) ? 'N/A' : productDetails.os}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Pin:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.battery) ? 'N/A' : productDetails.battery}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Trọng lượng:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.weight) ? 'N/A' : productDetails.weight}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Chất liệu:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.material) ? 'N/A' : productDetails.material}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Màu sắc:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.color) ? 'N/A' : productDetails.color}"
                ></dd>

                <dt
                  class="description-term col-xs-12 col-sm-12 col-md-4 col-lg-2 col-xl-2"
                >
                  Kích thước:
                </dt>
                <dd
                  class="description-detail col-xs-12 col-sm-12 col-md-8 col-lg-10 col-xl-10"
                  th:text="${#strings.isEmpty(productDetails.size) ? 'N/A' : productDetails.size}"
                ></dd>
              </dl>
            </div>
          </div>
        </div>

        <!-- product details footer -->
        <div class="product-details-footer">
          <div class="review">
            <h2 class="review-title">Đánh giá</h2>

            <!-- review summary -->
            <div class="review-summary product-review-summary">
              <div class="reviews-summary-header">
                <div class="review-average">
                  <span
                    class="review-average-value"
                    th:text="${productDetails.averageRating}"
                  ></span
                  >/5
                </div>
                <div class="review-stars">
                  <i
                    th:with="score=${productDetails.averageRating}"
                    class="fa-solid"
                    th:each="i : ${#numbers.sequence(1, 5)}"
                    th:classappend="${i <= T(java.lang.Math).floor(score) ? 'fa-star active' : i - 1 < score ? 'fa-star-half-stroke active' : 'fa-star'}"
                  >
                  </i>
                </div>
                <div class="review-count">
                  <span th:text="${productDetails.totalRatings}"></span>
                  lượt đánh giá
                </div>
                <button
                  id="createReviewBtn"
                  class="create-review-button primary-button"
                  th:if="${productDetails.myReview == null and productDetails.isPurchased == true}"
                  th:attr="data-product-id=${productDetails.id}"
                >
                  Thêm đánh giá
                </button>
                <div id="reviewModal" class="review-modal"></div>
              </div>

              <ul class="review-average-bars">
                <li class="review-average-bar">
                  <div class="average-progress-bar">
                    <div class="average-bar-label">
                      5<i class="fa-solid fa-star active"></i>
                    </div>
                    <div class="average-bar-default">
                      <span
                        class="average-bar-fill"
                        th:style="'right:' + ${100 - productDetails.ratingPercentages.get(5)} + '%'"
                      >
                      </span>
                    </div>
                  </div>
                  <div class="review-count">
                    (<span
                      th:text="${productDetails.ratingCount.get(5)}"
                    ></span>
                    lượt đánh giá)
                  </div>
                </li>

                <li class="review-average-bar">
                  <div class="average-progress-bar">
                    <div class="average-bar-label">
                      4<i class="fa-solid fa-star active"></i>
                    </div>
                    <div class="average-bar-default">
                      <span
                        class="average-bar-fill"
                        th:style="'right:' + ${100 - productDetails.ratingPercentages.get(4)} + '%'"
                      >
                      </span>
                    </div>
                  </div>
                  <div class="review-count">
                    (<span
                      th:text="${productDetails.ratingCount.get(4)}"
                    ></span>
                    lượt đánh giá)
                  </div>
                </li>

                <li class="review-average-bar">
                  <div class="average-progress-bar">
                    <div class="average-bar-label">
                      3<i class="fa-solid fa-star active"></i>
                    </div>
                    <div class="average-bar-default">
                      <span
                        class="average-bar-fill"
                        th:style="'right:' + ${100 - productDetails.ratingPercentages.get(3)} + '%'"
                      >
                      </span>
                    </div>
                  </div>
                  <div class="review-count">
                    (<span
                      th:text="${productDetails.ratingCount.get(3)}"
                    ></span>
                    lượt đánh giá)
                  </div>
                </li>

                <li class="review-average-bar">
                  <div class="average-progress-bar">
                    <div class="average-bar-label">
                      2<i class="fa-solid fa-star active"></i>
                    </div>
                    <div class="average-bar-default">
                      <span
                        class="average-bar-fill"
                        th:style="'right:' + ${100 - productDetails.ratingPercentages.get(2)} + '%'"
                      >
                      </span>
                    </div>
                  </div>
                  <div class="review-count">
                    (<span
                      th:text="${productDetails.ratingCount.get(2)}"
                    ></span>
                    lượt đánh giá)
                  </div>
                </li>

                <li class="review-average-bar">
                  <div class="average-progress-bar">
                    <div class="average-bar-label">
                      1<i class="fa-solid fa-star active"></i>
                    </div>
                    <div class="average-bar-default">
                      <span
                        class="average-bar-fill"
                        th:style="'right:' + ${100 - productDetails.ratingPercentages.get(1)} + '%'"
                      >
                      </span>
                    </div>
                  </div>
                  <div class="review-count">
                    (<span
                      th:text="${productDetails.ratingCount.get(1)}"
                    ></span>
                    lượt đánh giá)
                  </div>
                </li>
              </ul>
            </div>

            <!-- my review -->
            <div class="my-review" th:if="${productDetails.myReview != null}">
              <h3 class="my-review-title">Đánh giá của bạn</h3>
              <div class="my-review-content">
                <div class="review-stars">
                  <i
                    class="fa-solid fa-star"
                    th:each="i : ${#numbers.sequence(1, 5)}"
                    th:classappend="${i <= productDetails.myReview.rating} ? 'active' : ''"
                  >
                  </i>
                </div>
                <p
                  class="review-message"
                  th:text="${productDetails.myReview.message}"
                ></p>
                <p
                  class="review-post-time"
                  th:text="${#temporals.format(productDetails.myReview.createdAt, 'dd/MM/yyyy')}"
                ></p>
              </div>
              <div class="my-review-actions">
                <button
                  id="updateReviewBtn"
                  class="update-review-button warning-button"
                  th:attr="data-product-id=${productDetails.id}, data-review-id=${productDetails.myReview.id}"
                >
                  Sửa
                </button>
                <button
                  id="deleteReviewBtn"
                  class="delete-review-button danger-button"
                  th:attr="data-product-id=${productDetails.id}, data-review-id=${productDetails.myReview.id}"
                >
                  Xóa
                </button>
              </div>
            </div>

            <!-- user reviews -->
            <div
              class="user-reviews"
              th:if="${productDetails.userReviews != null and not productDetails.userReviews.isEmpty()}"
            >
              <h3 class="user-reviews-title">Đánh giá của người mua</h3>

              <ul class="review-list" th:if="${productDetails.userReviews}">
                <li
                  class="review-item"
                  th:each="review : ${productDetails.userReviews}"
                >
                  <div class="review-card">
                    <div class="review-user">
                      <div class="avatar">
                        <img
                          th:if="${#strings.isEmpty(review.user.avatar)}"
                          src="/images/default-avatar.png"
                          alt="avatar"
                        />
                        <img
                          th:if="${!#strings.isEmpty(review.user.avatar)}"
                          th:src="${'/' + resourcesMappingFolder + '/' + avatarsFolder + '/' + review.user.avatar}"
                          alt="avatar"
                        />
                      </div>
                      <div class="info">
                        <p
                          class="text name"
                          th:text="${review.user.getFullName()}"
                        ></p>
                        <p
                          class="text post-time"
                          th:text="${#temporals.format(review.createdAt, 'dd/MM/yyyy')}"
                        ></p>
                      </div>
                    </div>
                    <div class="review-content">
                      <div class="review-stars">
                        <i
                          class="fa-solid fa-star"
                          th:each="i : ${#numbers.sequence(1, 5)}"
                          th:classappend="${i <= review.rating} ? 'active' : ''"
                        >
                        </i>
                      </div>
                      <p class="review-message" th:text="${review.message}"></p>
                    </div>
                  </div>
                </li>
              </ul>

              <div class="reviews-actions">
                <a
                  class="view-all-button primary-button"
                  th:href="@{/shop/product/{slug}/reviews(slug=${productDetails.slug})}"
                  >Xem tất cả</a
                >
              </div>
            </div>
          </div>

          <!-- related products -->
          <div
            class="related-products"
            th:if="${productDetails.relatedProducts != null and !productDetails.relatedProducts.isEmpty()}"
          >
            <h2 class="related-products-title">Sản phẩm liên quan</h2>
            <div class="row">
              <div
                class="col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-3"
                th:each="product : ${productDetails.relatedProducts}"
              >
                <form
                  class="add-cart-form"
                  method="post"
                  th:action="@{/cart/add/{id}(id=${product.id})}"
                >
                  <a
                    th:href="@{/shop/product/{id}(id=${productSummary.id})}"
                    class="product-card"
                  >
                    <div class="product-image">
                      <img
                        th:src="${'/' + resourcesMappingFolder + '/' + productPicturesFolder + '/' + (productSummary.productImages != null and productSummary.productImages.size() > 0 ? productSummary.productImages[0].imageName : '')}"
                        alt="product"
                      />
                    </div>
                    <p
                      class="product-name"
                      th:text="${productSummary.name}"
                    ></p>
                    <div class="product-pricing">
                      <p
                        class="price"
                        th:text="${#numbers.formatDecimal(productSummary.discountPrice, 0, 'COMMA', 0, 'POINT')} + '₫'"
                      ></p>
                      <div
                        class="discount-information"
                        th:if="${productSummary.discount > 0}"
                      >
                        <span
                          class="old-price"
                          th:text="${#numbers.formatDecimal(productSummary.price, 0, 'COMMA', 0, 'POINT')} + '₫'"
                        ></span>
                        <span
                          class="discount-value danger-badge"
                          th:text="'-' + ${productSummary.discount} + '%'"
                        ></span>
                      </div>
                    </div>
                    <div
                      class="review-stars"
                      th:if="${productSummary.averageRating > 0}"
                    >
                      <i
                        class="fa-solid fa-star"
                        th:each="i : ${#numbers.sequence(1, 5)}"
                        th:classappend="${i <= productSummary.averageRating} ? 'active' : ''"
                      >
                      </i>
                    </div>
                  </a>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </body>

  <script layout:fragment="scripts" th:inline="javascript">
    // thumbnails carousel
    $(".thumbnails-carousel").owlCarousel({
      dots: false,
      nav: false,
      loop: false,
      margin: 10,
      responsive: {
        0: {
          items: 4,
        },

        576: {
          items: 5,
        },

        768: {
          items: 6,
        },

        992: {
          items: 3,
        },

        1200: {
          items: 4,
        },

        1400: {
          items: 5,
        },

        1600: {
          items: 6,
        },
      },
    });

    // thumbnail click
    $(document).on("click", ".owl-item", function () {
      const imageUrl = $(this).find("img").attr("src");
      $(".product-images .main-image img").attr("src", imageUrl);
      $(".product-images .main-image ").attr("href", imageUrl);

      const owlIndex = $(this).index();
      $(".owl-stage-outer").trigger("to.owl.carousel", owlIndex);

      $(".owl-item").find(".thumbnail").removeClass("active");

      $(this).find(".thumbnail").addClass("active");
    });

    // quantity
    const quantityInput = $(".quantity-input");
    const btnQuantityPlus = $("#btnQuantityPlus");
    const btnQuantityMinus = $("#btnQuantityMinus");
    const quantityLimit = 100;

    btnQuantityMinus.click(function () {
      if (quantityInput.val() > 1) {
        quantityInput.val(parseInt(quantityInput.val()) - 1);
      }
    });

    btnQuantityPlus.click(function () {
      if (quantityInput.val() < quantityLimit) {
        quantityInput.val(parseInt(quantityInput.val()) + 1);
      }
    });

    // rating
    $(document).on("click", ".rating i", function () {
      const stars = $(this).parent().find("i");
      const index = stars.index(this);

      for (let i = index + 1; i <= stars.length; i++) {
        $(stars[i]).removeClass("active");
      }

      for (let i = 0; i <= index; i++) {
        $(stars[i]).addClass("active");
      }

      $("#rating").val(index + 1);
    });

    const body = $("body");
    const overlay = $(".overlay");

    // show create review modal
    $("#createReviewBtn").click(function () {
      const productId = $(this).data("product-id");

      $.ajax({
        type: "get",
        url: `/review/${productId}/create`,
        dataType: "html",
        success: function (response, status, xhr) {
          const reviewModal = $("#reviewModal");
          reviewModal.empty();
          reviewModal.append(response);

          body.css("overflow", "hidden");
          overlay.addClass("show");

          const createReviewModal = reviewModal.children();
          if (createReviewModal.length > 0) {
            requestAnimationFrame(() => {
              requestAnimationFrame(() => {
                createReviewModal.addClass("show");
              });
            });
          }
        },
        error: function (xhr) {
          let response = null;

          try {
            response = JSON.parse(xhr.responseText);
          } catch (e) {
            console.warn("Response is not valid JSON:", e);
          }

          if (response && response.message) {
            localStorage.setItem("errorMessage", response.message);
          }

          if (xhr.status === 401) {
            window.location.href = "/auth/login";
          } else if (xhr.status === 400) {
            location.reload();
          } else if (xhr.status === 404) {
            if (response && response.data) {
              window.location.href = response.data;
            }
          } else if (xhr.status === 409) {
            location.reload();
          } else {
            document.open();
            document.write(xhr.responseText);
            document.close();
          }
        },
      });
    });

    // submit create review modal form
    $(document).on("submit", "#createReviewModal", function (e) {
      e.preventDefault();

      const productId = $(this).data("product-id");
      const formData = new FormData(this);

      const token = $("meta[name='_csrf']").attr("content");
      const header = $("meta[name='_csrf_header']").attr("content");

      $.ajax({
        type: "post",
        url: `/review/${productId}/create`,
        beforeSend: function (request) {
          request.setRequestHeader(header, token);
        },
        data: formData,
        contentType: false,
        processData: false,
        success: function (response, status, xhr) {
          if (xhr.status == 201) {
            localStorage.setItem("successMessage", xhr.responseJSON.message);
            location.reload();
          }
        },
        error: function (xhr) {
          let response = null;

          try {
            response = JSON.parse(xhr.responseText);
          } catch (e) {
            console.warn("Response is not valid JSON:", e);
          }

          if (response && response.message) {
            localStorage.setItem("errorMessage", response.message);
          }

          if (xhr.status === 422) {
            if (response && response.data) {
              const errors = response.data;
              $(".input-error-message").text("");
              $("input").removeClass("error");

              for (const field in errors) {
                if (errors.hasOwnProperty(field)) {
                  $("#" + field + "Error").text(errors[field]);
                  $("#" + field).addClass("error");
                }
              }
            }
          } else if (xhr.status === 401) {
            window.location.href = "/auth/login";
          } else if (xhr.status === 400) {
            location.reload();
          } else if (xhr.status === 404) {
            if (response && response.data) {
              window.location.href = response.data;
            }
          } else if (xhr.status === 409) {
            location.reload();
          } else {
            document.open();
            document.write(xhr.responseText);
            document.close();
          }
        },
      });
    });

    // show update review modal
    $("#updateReviewBtn").click(function () {
      const reviewId = $(this).data("review-id");
      const productId = $(this).data("product-id");

      $.ajax({
        type: "get",
        url: `/review/${productId}/update/${reviewId}`,
        dataType: "html",
        success: function (response, status, xhr) {
          const reviewModal = $("#reviewModal");
          reviewModal.empty();
          reviewModal.append(response);

          body.css("overflow", "hidden");
          overlay.addClass("show");

          const updateReviewModal = reviewModal.children();
          if (updateReviewModal.length > 0) {
            requestAnimationFrame(() => {
              requestAnimationFrame(() => {
                updateReviewModal.addClass("show");
              });
            });
          }
        },
        error: function (xhr) {
          let response = null;

          try {
            response = JSON.parse(xhr.responseText);
          } catch (e) {
            console.warn("Response is not valid JSON:", e);
          }

          if (response && response.message) {
            localStorage.setItem("errorMessage", response.message);
          }

          if (xhr.status === 401) {
            window.location.href = "/auth/login";
          } else if (xhr.status === 400) {
            location.reload();
          } else if (xhr.status === 404) {
            if (response && response.data) {
              window.location.href = response.data;
            }
          } else if (xhr.status === 409) {
            location.reload();
          } else {
            document.open();
            document.write(xhr.responseText);
            document.close();
          }
        },
      });
    });

    // submit update review modal form
    $(document).on("submit", "#updateReviewModal", function (e) {
      e.preventDefault();

      const productId = $(this).data("product-id");
      const reviewId = $(this).data("review-id");
      const formData = new FormData(this);

      const token = $("meta[name='_csrf']").attr("content");
      const header = $("meta[name='_csrf_header']").attr("content");

      $.ajax({
        type: "post",
        url: `/review/${productId}/update`,
        beforeSend: function (request) {
          request.setRequestHeader(header, token);
        },
        data: formData,
        contentType: false,
        processData: false,
        success: function (response, status, xhr) {
          if (xhr.status == 200) {
            localStorage.setItem("successMessage", xhr.responseJSON.message);
            location.reload();
          }
        },
        error: function (xhr) {
          let response = null;

          try {
            response = JSON.parse(xhr.responseText);
          } catch (e) {
            console.warn("Response is not valid JSON:", e);
          }

          if (response && response.message) {
            localStorage.setItem("errorMessage", response.message);
          }

          if (xhr.status === 422) {
            if (response && response.data) {
              const errors = response.data;
              $(".input-error-message").text("");
              $("input").removeClass("error");

              for (const field in errors) {
                if (errors.hasOwnProperty(field)) {
                  $("#" + field + "Error").text(errors[field]);
                  $("#" + field).addClass("error");
                }
              }
            }
          } else if (xhr.status === 401) {
            window.location.href = "/auth/login";
          } else if (xhr.status === 400) {
            location.reload();
          } else if (xhr.status === 404) {
            if (response && response.data) {
              window.location.href = response.data;
            }
          } else if (xhr.status === 409) {
            location.reload();
          } else {
            document.open();
            document.write(xhr.responseText);
            document.close();
          }
        },
      });
    });

    // show delete review modal
    $("#deleteReviewBtn").click(function () {
      const productId = $(this).data("product-id");
      const reviewId = $(this).data("review-id");

      $.ajax({
        type: "get",
        url: `/review/${productId}/delete/${reviewId}`,
        dataType: "html",
        success: function (response, status, xhr) {
          const reviewModal = $("#reviewModal");
          reviewModal.empty();
          reviewModal.append(response);

          body.css("overflow", "hidden");
          overlay.addClass("show");

          const deleteReviewModal = reviewModal.children();
          if (deleteReviewModal.length > 0) {
            requestAnimationFrame(() => {
              requestAnimationFrame(() => {
                deleteReviewModal.addClass("show");
              });
            });
          }
        },
        error: function (xhr) {
          let response = null;

          try {
            response = JSON.parse(xhr.responseText);
          } catch (e) {
            console.warn("Response is not valid JSON:", e);
          }

          if (response && response.message) {
            localStorage.setItem("errorMessage", response.message);
          }

          if (xhr.status === 401) {
            window.location.href = "/auth/login";
          } else if (xhr.status === 400) {
            location.reload();
          } else if (xhr.status === 404) {
            if (response && response.data) {
              window.location.href = response.data;
            }
          } else if (xhr.status === 409) {
            location.reload();
          } else {
            document.open();
            document.write(xhr.responseText);
            document.close();
          }
        },
      });
    });

    // submit delete review modal form
    $(document).on("submit", "#deleteReviewModal", function (e) {
      e.preventDefault();

      const productId = $(this).data("product-id");
      const formData = new FormData(this);

      const token = $("meta[name='_csrf']").attr("content");
      const header = $("meta[name='_csrf_header']").attr("content");

      $.ajax({
        type: "post",
        url: `/review/${productId}/delete`,
        beforeSend: function (request) {
          request.setRequestHeader(header, token);
        },
        data: formData,
        contentType: false,
        processData: false,
        success: function (response, status, xhr) {
          if (xhr.status == 200) {
            localStorage.setItem("successMessage", xhr.responseJSON.message);
            location.reload();
          }
        },

        error: function (xhr) {
          let response = null;

          try {
            response = JSON.parse(xhr.responseText);
          } catch (e) {
            console.warn("Response is not valid JSON:", e);
          }

          if (response && response.message) {
            localStorage.setItem("errorMessage", response.message);
          }

          if (xhr.status === 401) {
            window.location.href = "/auth/login";
          } else if (xhr.status === 400) {
            location.reload();
          } else if (xhr.status === 404) {
            if (response && response.data) {
              window.location.href = response.data;
            }
          } else if (xhr.status === 409) {
            location.reload();
          } else {
            document.open();
            document.write(xhr.responseText);
            document.close();
          }
        },
      });
    });
  </script>
</html>
